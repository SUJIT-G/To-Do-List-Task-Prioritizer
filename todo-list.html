<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List & Task Prioritizer ✅</title>
    <meta name="description" content="An advanced, responsive design for a To-Do List and Task Prioritizer with features like due dates, priority levels, and filtering.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }
        .task-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
        }
        .task-card.completed {
            opacity: 0.6;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        [x-cloak] {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-4 min-h-screen flex items-center justify-center">

    <!-- Main Application Container -->
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl p-8 w-full max-w-2xl mx-auto flex flex-col space-y-6">

        <!-- Header -->
        <header class="flex items-center justify-between">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-white">To-Do List & Task Prioritizer ✅</h1>
            <!-- Dark Mode Toggle -->
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-200">
                <svg id="sun-icon" class="w-6 h-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="display: none;">
                    <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 1.586l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM16 10a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zm-8 2a1 1 0 100-2H6a1 1 0 100 2h2zM7.05 15.05a1 1 0 011.414 0l.707.707a1 1 0 01-1.414 1.414l-.707-.707a1 1 0 010-1.414zm-.707-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-1.414-1.414zM10 18a1 1 0 01-1-1v-1a1 1 0 112 0v1a1 1 0 01-1 1zm-2-7a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd" fill-rule="evenodd"></path>
                </svg>
                <svg id="moon-icon" class="w-6 h-6 text-gray-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.293 13.593a1 1 0 011.414 1.414L18 16a1 1 0 01-1 1h-1a1 1 0 01-1-1v-1a1 1 0 011-1zM10 2a8 8 0 018 8c0 1.933-.78 3.684-2.046 5.069A6.992 6.992 0 0010 17c-2.316 0-4.404-.925-5.962-2.431A8.001 8.001 0 012 10a8 8 0 018-8zm-1 2a6 6 0 00-6 6c0 1.25.32 2.432.898 3.513A5.002 5.002 0 0110 15a5.002 5.002 0 015-5c0-3.313-2.687-6-6-6z" clip-rule="evenodd" fill-rule="evenodd"></path>
                </svg>
            </button>
        </header>

        <!-- New Task Form -->
        <form id="task-form" class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-4">
            <input type="text" id="task-text" placeholder="Add a new task..." required class="flex-1 w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
            <select id="task-priority" class="px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                <option value="low">Low Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="high">High Priority</option>
            </select>
            <input type="date" id="task-date" class="px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
            <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">Add Task</button>
        </form>

        <!-- Task Controls (Search, Filter, Sort) -->
        <div class="flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0">
            <input type="text" id="task-search" placeholder="Search tasks..." class="flex-1 w-full sm:w-auto px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
            <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 ml-0 sm:ml-4 w-full sm:w-auto">
                <select id="filter-priority" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                    <option value="all">All Priorities</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
                <select id="sort-by" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200">
                    <option value="default">Sort by Default</option>
                    <option value="due-date">Due Date</option>
                    <option value="priority">Priority</option>
                </select>
            </div>
        </div>

        <!-- Task List -->
        <ul id="task-list" class="space-y-4">
            <!-- Task items will be dynamically added here by JavaScript -->
        </ul>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const taskForm = document.getElementById('task-form');
            const taskList = document.getElementById('task-list');
            const taskText = document.getElementById('task-text');
            const taskPriority = document.getElementById('task-priority');
            const taskDate = document.getElementById('task-date');
            const taskSearch = document.getElementById('task-search');
            const filterPriority = document.getElementById('filter-priority');
            const sortSelect = document.getElementById('sort-by');
            const themeToggle = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');

            let tasks = [];

            // --- Local Storage Functions ---
            const saveTasks = () => {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            };

            const loadTasks = () => {
                const storedTasks = localStorage.getItem('tasks');
                if (storedTasks) {
                    tasks = JSON.parse(storedTasks);
                    renderTasks();
                }
            };

            // --- Theme Toggle Logic ---
            const toggleTheme = () => {
                document.documentElement.classList.toggle('dark');
                const isDarkMode = document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                updateThemeIcons(isDarkMode);
            };

            const updateThemeIcons = (isDarkMode) => {
                if (isDarkMode) {
                    sunIcon.style.display = 'block';
                    moonIcon.style.display = 'none';
                } else {
                    sunIcon.style.display = 'none';
                    moonIcon.style.display = 'block';
                }
            };

            const initializeTheme = () => {
                const storedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const isDarkMode = storedTheme === 'dark' || (!storedTheme && prefersDark);
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                }
                updateThemeIcons(isDarkMode);
            };

            themeToggle.addEventListener('click', toggleTheme);

            // --- Task Rendering Function ---
            const renderTasks = () => {
                // Get current filter and sort values
                const searchTerm = taskSearch.value.toLowerCase();
                const currentFilter = filterPriority.value;
                const currentSort = sortSelect.value;

                // Filter tasks based on search and priority
                let filteredTasks = tasks.filter(task => {
                    const matchesSearch = task.text.toLowerCase().includes(searchTerm);
                    const matchesFilter = currentFilter === 'all' || task.priority === currentFilter;
                    return matchesSearch && matchesFilter;
                });

                // Sort tasks
                if (currentSort === 'due-date') {
                    filteredTasks.sort((a, b) => {
                        const dateA = a.dueDate ? new Date(a.dueDate) : new Date('9999-12-31');
                        const dateB = b.dueDate ? new Date(b.dueDate) : new Date('9999-12-31');
                        return dateA - dateB;
                    });
                } else if (currentSort === 'priority') {
                    const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                    filteredTasks.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
                }

                // Clear the list before rendering
                taskList.innerHTML = '';

                if (filteredTasks.length === 0) {
                    const message = document.createElement('li');
                    message.className = 'text-center text-gray-500 dark:text-gray-400 py-4 italic';
                    message.textContent = 'No tasks found. Try adding a new task!';
                    taskList.appendChild(message);
                    return;
                }

                // Create and append task elements
                filteredTasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = `task-card flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 rounded-lg bg-gray-50 dark:bg-gray-700 shadow-md transition-colors duration-200 ${task.completed ? 'opacity-50' : ''}`;
                    li.dataset.id = task.id;

                    const priorityColor = {
                        'high': 'bg-red-500',
                        'medium': 'bg-yellow-500',
                        'low': 'bg-green-500'
                    };

                    li.innerHTML = `
                        <div class="flex items-center space-x-3 w-full sm:w-auto mb-2 sm:mb-0">
                            <input type="checkbox" class="form-checkbox h-5 w-5 rounded-md text-blue-600 dark:text-blue-400 bg-gray-200 dark:bg-gray-600 border-gray-300 dark:border-gray-500 focus:ring-blue-500 cursor-pointer" ${task.completed ? 'checked' : ''}>
                            <span class="text-lg font-medium ${task.completed ? 'line-through text-gray-400 dark:text-gray-500' : ''}">${task.text}</span>
                        </div>
                        <div class="flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400 w-full sm:w-auto justify-end">
                            <div class="flex items-center space-x-2">
                                <span class="w-2 h-2 ${priorityColor[task.priority]} rounded-full"></span>
                                <span class="capitalize">${task.priority}</span>
                            </div>
                            <span class="flex-shrink-0">Due: ${task.dueDate || 'N/A'}</span>
                            <div class="flex space-x-2">
                                <button class="edit-btn p-1 rounded-full text-gray-600 dark:text-gray-400 hover:text-blue-500">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-7.586 7.586a2 2 0 01-1.414.586H6a2 2 0 01-2-2v-2.586a2 2 0 01.586-1.414l7.586-7.586zM15 5l1 1-7 7H9v-2l7-7z"></path>
                                    </svg>
                                </button>
                                <button class="delete-btn p-1 rounded-full text-gray-600 dark:text-gray-400 hover:text-red-500">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 011-1h2a1 1 0 011 1H9a1 1 0 00-1 1v1h4v-1a1 1 0 01-1-1H9a1 1 0 01-1 1v1H4a1 1 0 01-1-1V3a1 1 0 011-1h5zM4 5h12v12a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm6-2a1 1 0 00-1-1h2a1 1 0 00-1 1z" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;

                    // Add event listeners for the new task item's buttons
                    const checkbox = li.querySelector('input[type="checkbox"]');
                    const deleteBtn = li.querySelector('.delete-btn');
                    const editBtn = li.querySelector('.edit-btn');

                    checkbox.addEventListener('change', () => {
                        task.completed = checkbox.checked;
                        renderTasks();
                        saveTasks();
                    });

                    deleteBtn.addEventListener('click', () => {
                        tasks = tasks.filter(t => t.id !== task.id);
                        renderTasks();
                        saveTasks();
                    });
                    
                    editBtn.addEventListener('click', () => {
                        const newText = prompt("Edit the task:", task.text);
                        if (newText !== null && newText.trim() !== "") {
                            task.text = newText.trim();
                            renderTasks();
                            saveTasks();
                        }
                    });

                    taskList.appendChild(li);
                });
            };

            // --- Event Listeners ---
            taskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const text = taskText.value.trim();
                const priority = taskPriority.value;
                const dueDate = taskDate.value;

                if (text) {
                    const newTask = {
                        id: Date.now(),
                        text,
                        priority,
                        dueDate,
                        completed: false
                    };
                    tasks.push(newTask);
                    taskText.value = '';
                    taskDate.value = '';
                    renderTasks();
                    saveTasks();
                }
            });

            taskSearch.addEventListener('input', renderTasks);
            filterPriority.addEventListener('change', renderTasks);
            sortSelect.addEventListener('change', renderTasks);

            // Initial load
            initializeTheme();
            loadTasks();
        });
    </script>

</body>
</html>
